@page
@model BookwormsOnlineSecurity.Pages.RegisterModel
@{
    ViewData["Title"] = "Register - Bookworms Online";
}

<div class="row justify-content-center mt-4 mb-5">
    <div class="col-lg-10">
        <div class="card shadow-sm">
            <div class="card-body">
                <h2 class="mb-3">Bookworms Online Membership</h2>
                <form method="post" enctype="multipart/form-data">
                    <div asp-validation-summary="All" class="text-danger"></div>
                    <input type="hidden" asp-for="RModel.RecaptchaToken" id="recaptchaToken" />

                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="RModel.FirstName"></label>
                                <input asp-for="RModel.FirstName" class="form-control" />
                                <span asp-validation-for="RModel.FirstName" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="RModel.LastName"></label>
                                <input asp-for="RModel.LastName" class="form-control" />
                                <span asp-validation-for="RModel.LastName" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="RModel.MobileNo"></label>
                                <input asp-for="RModel.MobileNo" class="form-control" />
                                <span asp-validation-for="RModel.MobileNo" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="RModel.Email"></label>
                                <input asp-for="RModel.Email" class="form-control" />
                                <span asp-validation-for="RModel.Email" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="RModel.Photo"></label>
                                <input asp-for="RModel.Photo" class="form-control" type="file" accept=".jpg" />
                                <span asp-validation-for="RModel.Photo" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="RModel.BillingAddress"></label>
                                <textarea asp-for="RModel.BillingAddress" class="form-control" rows="3"></textarea>
                                <span asp-validation-for="RModel.BillingAddress" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="RModel.ShippingAddress"></label>
                                <textarea asp-for="RModel.ShippingAddress" class="form-control" rows="3"></textarea>
                                <span asp-validation-for="RModel.ShippingAddress" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="RModel.CreditCard"></label>
                                <input asp-for="RModel.CreditCard" class="form-control" />
                                <span asp-validation-for="RModel.CreditCard" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mt-2">
                        <div class="col-md-6">
                            <label asp-for="RModel.Password"></label>
                            <input asp-for="RModel.Password" class="form-control" />
                            <div class="form-text" id="password-help">Password must be at least 12 characters and include uppercase, lowercase, number, and special character.</div>
                            <div id="password-strength" class="small fw-bold text-danger mb-1">Strength: Weak</div>
                            <ul class="small list-unstyled mb-1" id="password-requirements">
                                <li data-req="len" class="text-danger">• At least 12 characters</li>
                                <li data-req="upper" class="text-danger">• At least one uppercase letter</li>
                                <li data-req="lower" class="text-danger">• At least one lowercase letter</li>
                                <li data-req="digit" class="text-danger">• At least one number</li>
                                <li data-req="special" class="text-danger">• At least one special character</li>
                            </ul>
                            <span asp-validation-for="RModel.Password" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="RModel.ConfirmPassword"></label>
                            <input asp-for="RModel.ConfirmPassword" class="form-control" />
                            <span asp-validation-for="RModel.ConfirmPassword" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="mt-4 d-flex gap-2">
                        <button type="submit" class="btn btn-primary">Register</button>
                        <a asp-page="/Login" class="btn btn-outline-secondary">Back to Login</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="https://www.google.com/recaptcha/api.js?render=@Model.RecaptchaSiteKey"></script>
    <script>
        (() => {
            const pwd = document.getElementById('RModel_Password');
            const reqs = {
                len: v => v.length >= 12,
                upper: v => /[A-Z]/.test(v),
                lower: v => /[a-z]/.test(v),
                digit: v => /[0-9]/.test(v),
                special: v => /[^A-Za-z0-9]/.test(v)
            };
            const items = document.querySelectorAll('#password-requirements [data-req]');
            const strengthLabel = document.getElementById('password-strength');
            if (pwd) {
                const update = () => {
                    const val = pwd.value || '';
                    let passed = 0;
                    items.forEach(li => {
                        const key = li.getAttribute('data-req');
                        const ok = reqs[key]?.(val);
                        li.classList.toggle('text-success', ok);
                        li.classList.toggle('text-danger', !ok);
                        if (ok) passed++;
                    });
                    let strength = 'Weak';
                    let cls = 'text-danger';
                    if (passed >= 3 && val.length >= 12) {
                        strength = 'Medium';
                        cls = 'text-warning';
                    }
                    if (passed === 5 && val.length >= 14) {
                        strength = 'Strong';
                        cls = 'text-success';
                    }
                    strengthLabel.textContent = `Strength: ${strength}`;
                    strengthLabel.className = `small fw-bold ${cls} mb-1`;
                };
                pwd.addEventListener('input', update);
                update();
            }

            const siteKey = '@Model.RecaptchaSiteKey';
            const tokenField = document.getElementById('recaptchaToken');
            if (siteKey && tokenField && typeof grecaptcha !== 'undefined') {
                grecaptcha.ready(() => {
                    grecaptcha.execute(siteKey, { action: 'register' }).then(token => {
                        tokenField.value = token;
                    });
                });
            }
        })();
    </script>
}
